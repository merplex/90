<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏Ñ‡∏≤ - NINETY Point</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; display: flex; justify-content: center; padding: 20px; }
        .card { background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; padding: 25px; text-align: center; }
        .balance-box { background: #00b900; color: white; border-radius: 12px; padding: 15px; margin-bottom: 20px; }
        .balance-box span { font-size: 24px; font-weight: bold; }
        .grid-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .btn-price { background: #fff; border: 2px solid #00b900; color: #00b900; border-radius: 15px; padding: 15px 5px; font-size: 18px; font-weight: bold; cursor: pointer; }
        .btn-price:active { background: #00b900; color: white; }
    </style>
</head>
<body>
<div class="card">
    <h3>Ninety Wash</h3>
    <div class="balance-box">‡∏¢‡∏≠‡∏î‡πÅ‡∏ï‡πâ‡∏°: <span id="userPoints">...</span></div>
    <div class="grid-container">
        <button class="btn-price" onclick="selectPrice(10)">10</button>
        <button class="btn-price" onclick="selectPrice(20)">20</button>
        <button class="btn-price" onclick="selectPrice(30)">30</button>
        <button class="btn-price" onclick="selectPrice(40)">40</button>
        <button class="btn-price" onclick="selectPrice(50)">50</button>
        <button class="btn-price" onclick="selectPrice(60)">60</button>
        <button class="btn-price" onclick="selectPrice(70)">70</button>
        <button class="btn-price" onclick="selectPrice(80)">80</button>
        <button class="btn-price" onclick="selectPrice(90)">90</button>
    </div>
</div>
<script>
    let userId = "";
    async function main() {
        await liff.init({ liffId: "2008944819-N4ozrStq" }); //
        if (!liff.isLoggedIn()) { liff.login(); } 
        else {
            const profile = await liff.getProfile();
            userId = profile.userId;
            const res = await fetch(`/api/get-user-points?userId=${userId}`);
            const data = await res.json();
            document.getElementById('userPoints').innerText = data.points;
        }
    }
    async function selectPrice(amount) {
        try {
            const result = await liff.scanCode(); // ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏π‡πâ
            const machineId = result.value;
            if (machineId) {
                const response = await fetch(`/liff/redeem-execute?userId=${userId}&amount=${amount}&machine_id=${machineId}`);
                const text = await response.text();
                if (text.includes("SUCCESS")) { liff.closeWindow(); }
            }
        }   catch (err) {
    // ‡πÇ‡∏ä‡∏ß‡πå‡∏£‡∏´‡∏±‡∏™ Error ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà LINE ‡∏™‡πà‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏à‡∏£‡∏¥‡∏á‡πÜ
    alert("üî¥ ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!\nCode: " + err.code + "\nMessage: " + err.message);
    console.error(err);
}

    }
    main();
</script>
</body>
</html>
